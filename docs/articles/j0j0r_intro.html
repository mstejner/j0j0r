<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>j0j0r: An R-package for numerical calculations of current correlation tensors • j0j0r</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="j0j0r: An R-package for numerical calculations of current correlation tensors">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">j0j0r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/j0j0r_intro.html">j0j0r: An R-package for numerical calculations of current correlation tensors</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mstejner/j0j0r">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>j0j0r: An R-package for numerical calculations of current correlation tensors</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mstejner/j0j0r/blob/master/vignettes/j0j0r_intro.Rmd"><code>vignettes/j0j0r_intro.Rmd</code></a></small>
      <div class="hidden name"><code>j0j0r_intro.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The j0j0r package is meant to calculate the unscreened current correlation tensor, <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span>, of the plasma fluctuation model of <a href="https://www.sciencedirect.com/science/article/pii/0021916995001298">Bindslev 1996, Journal of Atmospheric and Terrestial Physics, <strong>58</strong>, 983</a>.</p>
<p>The elements of <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> are given by Eq. 25 and 26 of <a href="https://www.sciencedirect.com/science/article/pii/0021916995001298">Bindslev 1996</a> or by Eq. 7 and 8 of <a href="https://orbit.dtu.dk/files/5555263/Stejner_preprint.pdf">Stejner et al 2011 PPCF, <strong>53</strong>, 065020</a>:</p>
<p><span class="math display">\[\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle = (2\pi)^2 \frac{m_a q_a^2}{\lvert k_\parallel \rvert} \int dp_\perp p_\perp \sum_{l = -\infty}^\infty {\bf c}_l {\bf c}_l^*f^{(a0)}(p_\perp, p_\parallel)\]</span></p>
<p>and</p>
<p><span class="math display">\[ {\bf c}_l = \left(\begin{array}{c} \frac{l\omega_{ca}}{k_\parallel}J_l(k_\perp\rho) \\ -iv_\perp J'_l(k_\perp\rho) \\ v_\parallel J_l(k_\perp\rho) \end{array}\right), \quad p_\parallel = m_a\frac{\omega -l\omega_{ca}}{k_\parallel}, \quad \rho = v_\perp/\omega_{ca}, \quad \omega_{ca} = q_aB^{(0)}/m_a \]</span></p>
<p>with notation as in the references.</p>
<p>The code is meant to be distribution-agnostic, i.e. it should be able to handle any reasonable form of the momentum distribution. The integral over perpendicular momentum is calculated numerically with <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/integrate.html">stats::integrate</a> or one of the methods from the <a href="https://cran.r-project.org/web/packages/cubature/index.html">cubature package</a>. Analytic solutions, possible only in special cases, are not used/supported.</p>
<p>The code is intended to be flexible and easy to use, but it is not meant for speed. However, the code does support parallelized calculations using the <a href="https://cran.r-project.org/web/packages/future/">future</a> and <a href="https://cran.r-project.org/web/packages/furrr/index.html">furrr</a> packages.</p>
</div>
<div id="distribution-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#distribution-functions" class="anchor"></a>Distribution functions</h1>
<p>New momentum distributions can be input in a specific format (described below). They do not need to be included in the package, but at present the package includes functions to set up the following distribution types:</p>
<ul>
<li><p>A simple isotropic Maxwellian distribution, see <code><a href="../reference/maxwellian_setup.html">maxwellian_setup()</a></code>.</p></li>
<li><p>A bi-Maxwellian distribution, with drift along the magnetic field (z-direction), see <code><a href="../reference/bimaxwellian_setup.html">bimaxwellian_setup()</a></code>.</p></li>
<li><p>A <a href="https://www.spenvis.oma.be/help/background/distributions/distributions.html">generalized Lorentzian / Kappa</a> distribution, see <code><a href="../reference/generalized_lorentzian_setup.html">generalized_lorentzian_setup()</a></code>.</p></li>
<li><p>A “Maxwellian-like” ring-distribution, see <code><a href="../reference/maxwellian_ring_setup.html">maxwellian_ring_setup()</a></code>.</p></li>
<li><p>A bivariate normal distribution, see <code><a href="../reference/bvtnorm_setup.html">bvtnorm_setup()</a></code>.</p></li>
<li><p>A slowdown distribution: an isotropic fast-ion slowdown with transport modifications as formulated by George J. Wilkie, see <a href="https://arxiv.org/abs/1808.01934v2">https://arxiv.org/abs/1808.01934v2</a> and <code><a href="../reference/slowdown_setup.html">slowdown_setup()</a></code>.</p></li>
</ul>
<div id="conventions-for-distribution-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#conventions-for-distribution-functions" class="anchor"></a>Conventions for distribution functions</h2>
<p>A particle and its momentum distribution can be input to the code as a list with elements:</p>
<ul>
<li><p><strong>name</strong>, a text string: some name for the particle, e.g. “Deuterium”.</p></li>
<li><p><strong>A</strong> and <strong>Z</strong>, integers: mass and charge numbers.</p></li>
<li>
<p><strong>distribution</strong>, a list with elements:</p>
<ul>
<li><p><strong>function_name</strong>, a text string: name of function to be called to evaluate the distribution.</p></li>
<li><p><strong>gradient,</strong> a text string: name of function to be called to be called to evaluate the gradient of the distribution. This intended for future use and isnNot used at present - so optional.</p></li>
<li><p><strong>distargs</strong>, a named list: all arguments to the distribution function other than p_par and p_perp, e.g. density and thermal momentum.</p></li>
<li><p><strong>p_scale</strong>, a double: a typical/representative momentum scale. Used to scale momentum so it is near 1 in calls to <code><a href="https://rdrr.io/r/stats/integrate.html">stats::integrate()</a></code> and the cubature methods.</p></li>
</ul>
</li>
</ul>
<p>Such a list does not have to be constructed using functions from the package, but the package includes some examples (mentioned above) of how this can be done.</p>
<p>The code assumes that the distributions are in cylindrical coordinates and symmetric about the magnetic field, so <span class="math inline">\({\bf p} = (p_\perp, p_\parallel)\)</span> where the magnetic field is in the z-direction. Thus, <span class="math inline">\(p_\perp =\sqrt{(p_x^2 + p_y^2)}\)</span> and <span class="math inline">\(p_\parallel = p_z\)</span>. When transforming between different coordinate system, the distribution function must remain normalized. So</p>
<p><span class="math display">\[ 
n = \int f({\bf p}) d{\bf p} = \int f(p_x, p_y, p_z)dp_x dp_y dp_z = 2\pi\int f(p_\perp, p_\parallel) p_\perp dp_\perp dp_\parallel 
\]</span></p>
<p>Where the final equality again assumes symmetry around the megnetic field (z-axis), so the integral over azimuthal angle contributes a factor <span class="math inline">\(2\pi\)</span>.</p>
<p>Note that with this convention, the factor <span class="math inline">\(2\pi p_\perp\)</span> is considered part of the volume element, not of the distribution function. So with this convention the expression for a Maxwellian velocity distribution is</p>
<p><span class="math display">\[
f_{maxw}(p_\perp, p_\parallel) = \frac{n}{(\sqrt{\pi}p_t)^3}e^{-(p_\perp^2 + p_\parallel^2)/p_t}, \quad
p_t = \sqrt{2k_bTm}
\]</span></p>
<p>where <span class="math inline">\(T\)</span> is temperature, <span class="math inline">\(k_b\)</span> Boltzmann’s constant and <span class="math inline">\(p_t\)</span> is the thermal momentum corresponding to the thermal velocity <span class="math inline">\(v_t = \sqrt{2k_bT/m}\)</span>.</p>
</div>
<div id="examples-of-distribution-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#examples-of-distribution-functions" class="anchor"></a>Examples of distribution functions</h2>
<p>For the examples below, we attach the <code>j0j0r</code> and <code>magrittr</code> packages:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(j0j0r)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(magrittr)</a></code></pre></div>
<p>and to make use of the parallelization with the <code>furrr</code> package we set a plan for the <code>future</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">future<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/future/man/plan.html">plan</a></span>(<span class="dt">strategy =</span> <span class="st">"multisession"</span>)</a></code></pre></div>
<p>A Maxwellian distribution and a slowdown distribution (with b = 3, indicating strong effects of transport) can be set up with:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">maxwellian_deuterium &lt;-<span class="st"> </span><span class="kw"><a href="../reference/maxwellian_setup.html">maxwellian_setup</a></span>(</a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="dt">n =</span> <span class="fl">4e19</span>,</a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="dt">T_eV =</span> <span class="dv">2000</span>,</a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="dt">A =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="dt">Z =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="dt">name =</span> <span class="st">"maxwellian"</span></a>
<a class="sourceLine" id="cb3-7" title="7">)</a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9">slowdown_deuterium &lt;-<span class="st"> </span><span class="kw"><a href="../reference/slowdown_setup.html">slowdown_setup</a></span>(</a>
<a class="sourceLine" id="cb3-10" title="10">  <span class="dt">b =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb3-11" title="11">  <span class="dt">n =</span> <span class="fl">4e19</span>,</a>
<a class="sourceLine" id="cb3-12" title="12">  <span class="dt">A =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb3-13" title="13">  <span class="dt">Z =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-14" title="14">  <span class="dt">birth_energy =</span> <span class="fl">10e3</span>,</a>
<a class="sourceLine" id="cb3-15" title="15">  <span class="dt">n_e =</span> <span class="fl">4e19</span>,</a>
<a class="sourceLine" id="cb3-16" title="16">  <span class="dt">T_e_eV =</span> <span class="fl">2e3</span>,</a>
<a class="sourceLine" id="cb3-17" title="17">  <span class="dt">ions =</span> <span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(</a>
<a class="sourceLine" id="cb3-18" title="18">    <span class="dt">Z =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-19" title="19">    <span class="dt">A =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb3-20" title="20">    <span class="dt">n =</span> <span class="fl">4e19</span></a>
<a class="sourceLine" id="cb3-21" title="21">  ),</a>
<a class="sourceLine" id="cb3-22" title="22">  <span class="dt">name =</span> <span class="st">"slowdown"</span></a>
<a class="sourceLine" id="cb3-23" title="23">)</a></code></pre></div>
<p>And they can be evaluated in a slice at <span class="math inline">\(v_\perp = 0\)</span> with</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">dist_examples &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calculate_distribution_data_frame.html">calculate_distribution_data_frame</a></span>(</a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="dt">particles =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="dt">maxwellian =</span> maxwellian_deuterium, </a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="dt">slowdown =</span> slowdown_deuterium</a>
<a class="sourceLine" id="cb4-5" title="5">    ), </a>
<a class="sourceLine" id="cb4-6" title="6">  <span class="dt">v_par =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="fl">1.5e6</span>, <span class="fl">1.5e6</span>, <span class="dt">length.out =</span> <span class="dv">1000</span>), </a>
<a class="sourceLine" id="cb4-7" title="7">  <span class="dt">v_perp =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb4-8" title="8">) </a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&gt; Vedhæfter pakke: 'purrr'</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">#&gt; Det følgende objekt er maskeret fra 'package:magrittr':</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">#&gt;     set_names</span></a>
<a class="sourceLine" id="cb4-14" title="14"></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="kw"><a href="../reference/plot_dist.html">plot_dist</a></span>(dist_examples)</a></code></pre></div>
<p><img src="j0j0r_intro_files/figure-html/fig1-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Note that, although the code generally works with momentum distributions, they are shown here as velocity distrubutions in order to have more recognizable units/scales on the axis.</p>
<p>Also, as noted above, the factor <span class="math inline">\(2\pi p_\perp\)</span> is considered part of the volume element, not of the distribution function. So it is not included here.</p>
<p>The function <code><a href="../reference/calculate_distribution_data_frame.html">calculate_distribution_data_frame()</a></code> returns a data frame with the evaluated distribution for all combinations of its arguments: particles, v_par and v_perp. So a 2D-plot can be obtained by allowing both v_par and v_perp to vary:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw"><a href="../reference/calculate_distribution_data_frame.html">calculate_distribution_data_frame</a></span>(</a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="dt">particles =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="dt">maxwellian =</span> maxwellian_deuterium, </a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="dt">slowdown =</span> slowdown_deuterium</a>
<a class="sourceLine" id="cb5-5" title="5">    ), </a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="dt">v_par =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="fl">1e6</span>, <span class="fl">1e6</span>, <span class="dt">length.out =</span> <span class="dv">300</span>), </a>
<a class="sourceLine" id="cb5-7" title="7">  <span class="dt">v_perp =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="fl">1e6</span>, <span class="dt">length.out =</span> <span class="dv">300</span>) </a>
<a class="sourceLine" id="cb5-8" title="8">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="st">  </span><span class="kw"><a href="../reference/plot_dist.html">plot_dist</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="st">  </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>( <span class="op">~</span><span class="st"> </span>name)</a></code></pre></div>
<p><img src="j0j0r_intro_files/figure-html/unnamed-chunk-5-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The normalization can be checked with the function <code><a href="../reference/integrate_distribution.html">integrate_distribution()</a></code>. For example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="../reference/integrate_distribution.html">integrate_distribution</a></span>(<span class="dt">distribution =</span> maxwellian_deuterium[[<span class="st">"distribution"</span>]])</a></code></pre></div>
<p>[1] 4.000002e+19</p>
</div>
</div>
<div id="calculating-j0j0" class="section level1">
<h1 class="hasAnchor">
<a href="#calculating-j0j0" class="anchor"></a>Calculating j0j0</h1>
<p>The function <code><a href="../reference/j0j0_element.html">j0j0_element()</a></code> is used to calculate a single element of <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> for a single wave vector, frequency, distribution etc. The function <code><a href="../reference/j0j0.html">j0j0()</a></code> is a wrapper for parameter sweeps. It requires the following input:</p>
<ul>
<li><p><strong>k</strong>: length of fluctuation wave vector. No dispersion function is included with the package. So in the examples below, k is simply set to <span class="math inline">\(2\pi / \lambda\)</span> with <span class="math inline">\(\lambda = c/f = c/100e9\,s^{-1} = 0.003\,m\)</span></p></li>
<li><p><strong>phi</strong>: angle (in degrees) between wave vector and magnetic field, <span class="math inline">\(\phi = \angle({\bf k}, {\bf B})\)</span>.</p></li>
<li><p><strong>frequencies</strong>: fluctuation frequency in Hz.</p></li>
<li><p><strong>direction</strong>: one or more spatial directions (“x”, “y” or “z”).</p></li>
<li><p><strong>B</strong> strength of magnetic field in Tesla.</p></li>
<li><p><strong>particles</strong>: a list of particles with with mass, charge, and momentum distribution. As in the examples above.</p></li>
<li><p><strong>integration_method</strong>: either “stats” to use <code><a href="https://rdrr.io/r/stats/integrate.html">stats::integrate()</a></code> or one of the methods from the <a href="https://cran.r-project.org/web/packages/cubature/index.html">cubature package</a>: “hcubature”, “pcubature”, “cuhre”, “divonne”, “suave” or “vegas”. See also the <a href="https://cran.r-project.org/web/packages/cubature/vignettes/cubature.html">cubature vignette</a>.</p></li>
</ul>
<p>Regarding the integration methods, some experimentation may be needed to find find the best choice for a particular distribution function. The stats, hcubature and cuhre methods work reliably and give identical result (in all cases that I have tested). Stats is usually the fastest. The other methods are either very slow or fail to converge and just returns zero (although pcubature does work in some cases and is then very fast). The examples included here were computed with stats.</p>
<p>The time to compute a single element of <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> varies a great deal depending on the distribution function: from around 60 ms for a Maxwellian to 800 ms for the slowdowwn distribution and 1.5 s for the bi-variate normal distribution.</p>
<p>The package contains an exported data set, j0j0_examples, with examples of velocity distributions and results for <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span>. The examples are shown below. When nothing else is mentioned they were calculated with <span class="math inline">\(\phi = 80^\circ\)</span>, <span class="math inline">\(k = 2095.845 \,{\text m}^{-1}\)</span>, <span class="math inline">\(B = 2.5\,{\text T}\)</span>, <span class="math inline">\(n = 4e19 \,{\text m}^{-3}\)</span>, <span class="math inline">\(A=2\)</span>, <span class="math inline">\(Z=1\)</span>. Where relevant, a temperature around 2 keV is assumed.</p>
<div id="maxwellian" class="section level2">
<h2 class="hasAnchor">
<a href="#maxwellian" class="anchor"></a>Maxwellian</h2>
<p>We have already seen the expression for a Maxwellian and how to set it up. To calculate <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> we call <code><a href="../reference/j0j0.html">j0j0()</a></code>.</p>
<p>All the inputs for <code><a href="../reference/j0j0.html">j0j0()</a></code> can be vectors or lists with multiple elements, e.g. multiple frequencies, directions, resolved angles or particles. The function will form all unique combinations of its inputs and return <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> for each. So a sweep of frequency and direction for two values of phi can be done with:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">maxwellian_example &lt;-<span class="st"> </span><span class="kw"><a href="../reference/j0j0.html">j0j0</a></span>(</a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="dt">k =</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi <span class="op">/</span><span class="st"> </span>(j0j0r<span class="op">::</span>const<span class="op">$</span>c <span class="op">/</span><span class="st"> </span><span class="fl">100e9</span>),</a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="dt">phi =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">60</span>, <span class="dv">86</span>),</a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="dt">frequencies =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="fl">400e6</span>, <span class="dt">by =</span> <span class="fl">2e6</span>),</a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="dt">directions =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>),</a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="dt">B =</span> <span class="fl">2.5</span>,</a>
<a class="sourceLine" id="cb7-7" title="7">  <span class="dt">particles =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb7-8" title="8">    <span class="dt">maxwellian =</span> maxwellian_deuterium</a>
<a class="sourceLine" id="cb7-9" title="9">  ),</a>
<a class="sourceLine" id="cb7-10" title="10">  <span class="dt">integration_method =</span> <span class="st">"stats"</span></a>
<a class="sourceLine" id="cb7-11" title="11">)</a></code></pre></div>
<p>And the results can be plotted with:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw"><a href="../reference/plot_j0j0.html">plot_j0j0</a></span>(maxwellian_example, <span class="dt">wrap_by =</span> <span class="st">"element"</span>, <span class="dt">color_by =</span> <span class="st">"phi"</span>)</a></code></pre></div>
<p><img src="j0j0r_intro_files/figure-html/fig3-1.png" width="1536" style="display: block; margin: auto;"></p>
</div>
<div id="bimaxwellian" class="section level2">
<h2 class="hasAnchor">
<a href="#bimaxwellian" class="anchor"></a>Bimaxwellian</h2>
<p>The expression for a bi-maxwellian is</p>
<p><span class="math display">\[
f(p_\perp, p_\parallel) =\frac{n}{(2\pi)^3 p_{\perp\,T}^2 p_{\parallel\,T}} e^{-(p_\parallel - p_{drift})^2 /p_{\parallel\,T}^2 + p_\perp^2 / p_{\perp\,T}^2}
\]</span> where <span class="math inline">\(p_{\perp\,T}\)</span> and <span class="math inline">\(p_{\parallel\,T}\)</span> are the perpendicular and parallel thermal momenta, and <span class="math inline">\(p_{drift}\)</span> is the parallel drift velocity in <span class="math inline">\(m/s\)</span>.</p>
<p>It can be se up with</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">bimaxwellian &lt;-<span class="st">  </span><span class="kw"><a href="../reference/bimaxwellian_setup.html">bimaxwellian_setup</a></span>(</a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="dt">n =</span> <span class="fl">4e9</span>,</a>
<a class="sourceLine" id="cb9-3" title="3">  <span class="dt">T_eV_perp =</span> <span class="dv">2000</span>,</a>
<a class="sourceLine" id="cb9-4" title="4">  <span class="dt">T_eV_par =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb9-5" title="5">  <span class="dt">v_drift =</span> <span class="fl">2e5</span>,</a>
<a class="sourceLine" id="cb9-6" title="6">  <span class="dt">A =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb9-7" title="7">  <span class="dt">Z =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb9-8" title="8">  <span class="dt">name =</span>  <span class="st">"bimaxwellian"</span></a>
<a class="sourceLine" id="cb9-9" title="9">)</a></code></pre></div>
<p><img src="j0j0r_intro_files/figure-html/fig4-1.png" width="1536" style="display: block; margin: auto;"></p>
<p>This gives the <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> elements shown below.</p>
<p><img src="j0j0r_intro_files/figure-html/fig5-1.png" width="1536" style="display: block; margin: auto;"></p>
</div>
<div id="lorentzian" class="section level2">
<h2 class="hasAnchor">
<a href="#lorentzian" class="anchor"></a>Lorentzian</h2>
<p>The expression for the <a href="https://www.spenvis.oma.be/help/background/distributions/distributions.html">Generalized Lorentzian</a> is</p>
<p><span class="math display">\[
f(p_\perp, p_\parallel) = \frac{n}{(\sqrt{\pi}\theta)^3}\frac{\Gamma(\kappa + 1)}{\sqrt{\kappa^3}\Gamma(\kappa - \frac{1}{2})}\left(1 + \frac{p_\perp^2 + p_\parallel^2}{\kappa\theta^2}\right)^{-(\kappa+1)}
\]</span> with <span class="math display">\[
\theta = \sqrt\frac{(2\kappa -3)mkT}{\kappa}
\]</span> where <span class="math inline">\(\kappa\)</span> is a spectral index. For large <span class="math inline">\(\kappa\)</span> the distribution tends towards a Maxwellian. For small <span class="math inline">\(\kappa\)</span> it is much flatter and remains significant at far higher velocities. Calculations of <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> can therefore be slow for small <span class="math inline">\(\kappa\)</span> values. The example below was calculated with <span class="math inline">\(\kappa = 7\)</span>.</p>
<p>The distribution can be set up with</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">lorentzian &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generalized_lorentzian_setup.html">generalized_lorentzian_setup</a></span>(</a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="dt">n =</span> <span class="fl">4e19</span>,</a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="dt">T_eV =</span> <span class="dv">2000</span>,</a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="dt">kp =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb10-5" title="5">  <span class="dt">A =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb10-6" title="6">  <span class="dt">Z =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb10-7" title="7">  <span class="dt">name =</span> <span class="st">"lorentzian"</span></a>
<a class="sourceLine" id="cb10-8" title="8">)</a></code></pre></div>
<p><img src="j0j0r_intro_files/figure-html/fig6-1.png" width="1536" style="display: block; margin: auto;"></p>
<p>And we get the <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> components shown below.</p>
<p><img src="j0j0r_intro_files/figure-html/fig7-1.png" width="1536" style="display: block; margin: auto;"></p>
</div>
<div id="ring" class="section level2">
<h2 class="hasAnchor">
<a href="#ring" class="anchor"></a>Ring</h2>
<p>A ring distribution is set op analogously to a Maxwellian with the expression</p>
<p><span class="math display">\[
f(p_\perp, p_\parallel) =K\frac{n}{\sqrt{\pi} p_{\text{width}}} e^{-(p - p_{\text{radius}})^2/p_{\text{width}}^2},\quad p=\sqrt{p_\perp^2+p_\parallel^2}
\]</span> where <span class="math inline">\(K\)</span> is an integration constant (calculated numerically), <span class="math inline">\(p_{\text{width}}\)</span> controls the width of the ring, and <span class="math inline">\(p_{\text{radius}}\)</span> controls the radius of the ring.</p>
<p>This distribition has no particular physical underpinning/meaning. It is meant merely as an illustrative example. It is set up with:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">ring =<span class="st"> </span><span class="kw"><a href="../reference/maxwellian_ring_setup.html">maxwellian_ring_setup</a></span>(</a>
<a class="sourceLine" id="cb11-2" title="2">  <span class="dt">n =</span> <span class="fl">4e19</span>,</a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="dt">v_width =</span> <span class="fl">1.5e5</span>,</a>
<a class="sourceLine" id="cb11-4" title="4">  <span class="dt">v_rad =</span> <span class="fl">0.5e6</span>,</a>
<a class="sourceLine" id="cb11-5" title="5">  <span class="dt">A =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="dt">Z =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="dt">name =</span> <span class="st">"ring"</span></a>
<a class="sourceLine" id="cb11-8" title="8">)</a></code></pre></div>
<p><img src="j0j0r_intro_files/figure-html/fig8-1.png" width="1536" style="display: block; margin: auto;"></p>
<p>And we get the <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> components shown below.</p>
<p><img src="j0j0r_intro_files/figure-html/fig9-1.png" width="1536" style="display: block; margin: auto;"></p>
<p>Note these show features similar to the ion cyclotron features seen for Maxwellian disstributions when the resolved angle is near 90<span class="math inline">\(^\circ\)</span> (here <span class="math inline">\(\phi = 80^\circ\)</span>). This behaviour is discussed i more detail in the last section below.</p>
</div>
<div id="bivariate-normal" class="section level2">
<h2 class="hasAnchor">
<a href="#bivariate-normal" class="anchor"></a>Bivariate Normal</h2>
<p>A bivariate normal distribution is given by <span class="math display">\[
f(p_\perp, p_\parallel) = nK \frac{\exp\left(-\frac{1}{2}({\mathbf p} - \mathbf{\mu})^T\Sigma^{-1}({\mathbf p} - \mathbf{\mu})\right)}{\sqrt{(2\pi)^2}\lvert\Sigma\rvert},\quad {\mathbf p}= \left(\begin{array}{c} p_\perp \\ p_\parallel \end{array}\right)
\]</span> where <span class="math inline">\(K\)</span> is an integration constant (calculated numerically), <span class="math inline">\(\mathbf{\mu}\)</span> is the center of the distribution, and <span class="math inline">\(\Sigma\)</span> its covariance. In practice it is here implemented using the <code>dmvnorm</code> function from the <a href="https://cran.r-project.org/web/packages/mvtnorm/index.html">mvtnorm package</a>. The integration constant <span class="math inline">\(K\)</span> is included because <span class="math inline">\(p_\perp\)</span> cannot be negative (if it could, the normalization would be correct without <span class="math inline">\(K\)</span>).</p>
<p>Again, this distribution is merely an illustrative example with no particular physical underpinning. An example can be set up with:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">center &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5e5</span>, <span class="fl">3e5</span>)</a>
<a class="sourceLine" id="cb12-2" title="2">T_eV &lt;-<span class="st"> </span><span class="fl">2e3</span></a>
<a class="sourceLine" id="cb12-3" title="3">A &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb12-4" title="4">v_term &lt;-<span class="st"> </span><span class="kw"><a href="../reference/find_p_term.html">find_p_term</a></span>(T_eV, A) <span class="op">/</span><span class="st"> </span>(A <span class="op">*</span><span class="st"> </span>j0j0r<span class="op">::</span>const[[<span class="st">"amu"</span>]])</a>
<a class="sourceLine" id="cb12-5" title="5">covariance &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(v_term<span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="dv">4</span>, v_term<span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="dv">3</span>), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(v_term<span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="dv">5</span>, (v_term)<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7">bvtnorm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bvtnorm_setup.html">bvtnorm_setup</a></span>(</a>
<a class="sourceLine" id="cb12-8" title="8">  <span class="dt">n =</span> <span class="fl">4e19</span>,</a>
<a class="sourceLine" id="cb12-9" title="9">  <span class="dt">center =</span> center,</a>
<a class="sourceLine" id="cb12-10" title="10">  <span class="dt">covariance =</span> covariance,</a>
<a class="sourceLine" id="cb12-11" title="11">  <span class="dt">A =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb12-12" title="12">  <span class="dt">Z =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb12-13" title="13">  <span class="dt">name =</span> <span class="st">"bivariate_normal"</span></a>
<a class="sourceLine" id="cb12-14" title="14">)</a></code></pre></div>
<p><img src="j0j0r_intro_files/figure-html/fig10-1.png" width="1536" style="display: block; margin: auto;"></p>
<p>Note that in this example <span class="math inline">\({\bf v} = 0\)</span> is quite far from the distribution center at <span class="math inline">\({\bf v} = (5e5, 3e5)\, m/s\)</span>, which explains why the ring distribution appears much smaller than the Maxwellian in the 1D plot (the plot is a slice along <span class="math inline">\(v_{perp} = 0\)</span>, far from the center).</p>
<p>We get the <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> components shown below.</p>
<p><img src="j0j0r_intro_files/figure-html/fig11-1.png" width="1536" style="display: block; margin: auto;"></p>
</div>
<div id="slowdown" class="section level2">
<h2 class="hasAnchor">
<a href="#slowdown" class="anchor"></a>Slowdown</h2>
<p>The fast-ion slowdown distribution formulated by Wilkie, <a href="https://arxiv.org/abs/1808.01934v2">https://arxiv.org/abs/1808.01934v2</a>, includes effects of transport modifications - which tend to hollow out the distribution at small velocities. It is given by Eq. 2.9 in the reference and here implemented with the expression</p>
<p><span class="math display">\[
f(p_\perp, p_\parallel) = nK \frac{1}{p_c^3 + p^3}\left( \frac{p^3}{p_b^3}\frac{p_b^3 + p_c^3}{p^3 + p_c^3}\right)^{b/3}H(p_b -p),\quad p=\sqrt{p_\parallel^2+p_\perp^2}  
\]</span> where <span class="math inline">\(K\)</span> is an integration constant, <span class="math inline">\(p_b\)</span> is the birth momentum and <span class="math inline">\(p_c\)</span> the critical momentum: <span class="math display">\[
p_c=p_{te}\left( \frac{3\sqrt{\pi}}{4}\sum_i\frac{n_im_e}{n_em_i}Z_i^2\right)^{1/3}
\]</span> with <span class="math inline">\(p_{te}\)</span> the electron thermal momentum.</p>
<p>The parameter <span class="math inline">\(b\)</span> quantifies the importance of transport effects. For <span class="math inline">\(b=0\)</span> transport is negligible and the distribution corresponds to the classical slowdown distribution. For <span class="math inline">\(b = 10\)</span> it is highly significant and causes a bump-on-tail shape.</p>
<p>The integration constant <span class="math inline">\(K\)</span> is here calculated numerically. Theoretically, <span class="math inline">\(K = S_0\tau_s/4\pi\)</span> where <span class="math inline">\(S_0\)</span> is a source term and <span class="math inline">\(\tau_0\)</span> the slowdown time. Here it is instead assumed that the total fast-ion density, <span class="math inline">\(n\)</span>, is known rather than the source.</p>
<p>The distribution can be set up with (note the <em>ions</em> argument, used to calculate <span class="math inline">\(p_c\)</span>, can contain multiple species if relevant):</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">n &lt;-<span class="st"> </span><span class="fl">4e19</span></a>
<a class="sourceLine" id="cb13-2" title="2">A &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb13-3" title="3">Z &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb13-4" title="4"></a>
<a class="sourceLine" id="cb13-5" title="5">slowdown_b5 =<span class="st"> </span><span class="kw"><a href="../reference/slowdown_setup.html">slowdown_setup</a></span>(</a>
<a class="sourceLine" id="cb13-6" title="6">  <span class="dt">b =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb13-7" title="7">  <span class="dt">n =</span> n,</a>
<a class="sourceLine" id="cb13-8" title="8">  <span class="dt">A =</span> A,</a>
<a class="sourceLine" id="cb13-9" title="9">  <span class="dt">Z =</span> Z,</a>
<a class="sourceLine" id="cb13-10" title="10">  <span class="dt">birth_energy =</span> <span class="fl">20e3</span>,</a>
<a class="sourceLine" id="cb13-11" title="11">  <span class="dt">n_e =</span> n,</a>
<a class="sourceLine" id="cb13-12" title="12">  <span class="dt">T_e_eV =</span> <span class="fl">2e3</span>,</a>
<a class="sourceLine" id="cb13-13" title="13">  <span class="dt">ions =</span> <span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(</a>
<a class="sourceLine" id="cb13-14" title="14">    <span class="dt">Z =</span> Z,</a>
<a class="sourceLine" id="cb13-15" title="15">    <span class="dt">A =</span> A,</a>
<a class="sourceLine" id="cb13-16" title="16">    <span class="dt">n =</span> n</a>
<a class="sourceLine" id="cb13-17" title="17">  ),</a>
<a class="sourceLine" id="cb13-18" title="18">  <span class="dt">name =</span> <span class="st">"deuterium_slowdown_b5"</span></a>
<a class="sourceLine" id="cb13-19" title="19">)</a>
<a class="sourceLine" id="cb13-20" title="20"></a>
<a class="sourceLine" id="cb13-21" title="21">slowdown_b0 =<span class="st"> </span><span class="kw"><a href="../reference/slowdown_setup.html">slowdown_setup</a></span>(</a>
<a class="sourceLine" id="cb13-22" title="22">  <span class="dt">b =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb13-23" title="23">  <span class="dt">n =</span> n,</a>
<a class="sourceLine" id="cb13-24" title="24">  <span class="dt">A =</span> A,</a>
<a class="sourceLine" id="cb13-25" title="25">  <span class="dt">Z =</span> Z,</a>
<a class="sourceLine" id="cb13-26" title="26">  <span class="dt">birth_energy =</span> <span class="fl">20e3</span>,</a>
<a class="sourceLine" id="cb13-27" title="27">  <span class="dt">n_e =</span> n,</a>
<a class="sourceLine" id="cb13-28" title="28">  <span class="dt">T_e_eV =</span> <span class="fl">2e3</span>,</a>
<a class="sourceLine" id="cb13-29" title="29">  <span class="dt">ions =</span> <span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(</a>
<a class="sourceLine" id="cb13-30" title="30">    <span class="dt">Z =</span> Z,</a>
<a class="sourceLine" id="cb13-31" title="31">    <span class="dt">A =</span> A,</a>
<a class="sourceLine" id="cb13-32" title="32">    <span class="dt">n =</span> n</a>
<a class="sourceLine" id="cb13-33" title="33">  ),</a>
<a class="sourceLine" id="cb13-34" title="34">  <span class="dt">name =</span> <span class="st">"deuterium_slowdown_b0"</span></a>
<a class="sourceLine" id="cb13-35" title="35">)</a></code></pre></div>
<p><img src="j0j0r_intro_files/figure-html/fig12-1.png" width="1536" style="display: block; margin: auto;"><img src="j0j0r_intro_files/figure-html/fig12-2.png" width="1536" style="display: block; margin: auto;"></p>
<p>And we get the <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> components shown below.</p>
<p><img src="j0j0r_intro_files/figure-html/fig13-1.png" width="1536" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="effects-of-localized-features-in-the-velocity-distribution" class="section level1">
<h1 class="hasAnchor">
<a href="#effects-of-localized-features-in-the-velocity-distribution" class="anchor"></a>Effects of localized features in the velocity distribution</h1>
<p>In the examples above, <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span>, was seen to display ion cyclotron features for the Maxwellian distribution when <span class="math inline">\(\phi\)</span> is close to <span class="math inline">\(90^\circ\)</span>. And at values of <span class="math inline">\(\phi\)</span> rather far from <span class="math inline">\(90^\circ\)</span> for the ring and slowdown distributions - both of which have highly localized maxima and/or edges in velocity space.</p>
<p>We can understand this behaviour by considering the expression for <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> in a little more detail. It is useful to consider the expression as a sum of integrals:</p>
<p><span class="math display">\[\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle = (2\pi)^2 \frac{m_a q_a^2}{\lvert k_\parallel \rvert} \sum_{l = -\infty}^\infty \int dp_\perp p_\perp  {\bf c}_l {\bf c}_l^* f^{(a0)}(p_\perp, p_\parallel)\]</span></p>
<p>The integrals are evaluated along the whole range of <span class="math inline">\(p_\perp\)</span>, but only at specific values of <span class="math inline">\(p_\parallel\)</span>:</p>
<p><span class="math display">\[p_\parallel = m_a\frac{\omega -l\omega_{c}}{k_\parallel}\]</span></p>
<p>These are shown below for two deuterium distribution with <span class="math inline">\(\phi = 80^\circ\)</span> (thin white dashed lines) and <span class="math inline">\(\phi = 86^\circ\)</span> (thick black dashed lines). The frequency is assumed to be <span class="math inline">\(\omega = 6\omega_c = 2\pi \times 115\)</span> MHz. So In this case <span class="math inline">\(v_\parallel = 0\)</span> for <span class="math inline">\(l = 6\)</span>. The step to the next values of <span class="math inline">\(v_\parallel\)</span> is <span class="math inline">\(\delta v_\parallel = \omega_c/k_\parallel = 3.3e5\, m/s\)</span> for <span class="math inline">\(\phi = 80^\circ\)</span> and <span class="math inline">\(8.2e5\, m/s\)</span> for <span class="math inline">\(\phi = 86^\circ\)</span>. As <span class="math inline">\(\omega\)</span> changes these lines will move vertically in the plot.</p>
<p><img src="j0j0r_intro_files/figure-html/fig14-1.png" width="1536" style="display: block; margin: auto;"></p>
<p>In the maxwellian case, when <span class="math inline">\(\phi\)</span> is near <span class="math inline">\(90^\circ\)</span> and <span class="math inline">\(k_\parallel\)</span> is small, only a few, or even a single, value of <span class="math inline">\(l\)</span> will correspond to values of <span class="math inline">\(v_\parallel\)</span> that probe the region near the maximum at <span class="math inline">\(v_\parallel = 0\)</span>. As <span class="math inline">\(\omega\)</span> changes, the value of <span class="math inline">\(v_\parallel\)</span> for that value of <span class="math inline">\(l\)</span> will sweep across the maximum of the distribution giving rise to a maximum of <span class="math inline">\(\langle \widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span>.</p>
<p>When <span class="math inline">\(\phi\)</span> is further from <span class="math inline">\(90^\circ\)</span>, the step in <span class="math inline">\(v_\parallel\)</span> between different <span class="math inline">\(l\)</span> values is smaller. Several values of <span class="math inline">\(l\)</span> will then probe the region near the maximum, and the result for <span class="math inline">\(\widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> will be less sensitive to the specific value of <span class="math inline">\(\omega\)</span>.</p>
<p>This also explains why ion cyclytron structures are more prominent at lower temperatures: the peak in the velocity distribution is narrower and the maximum more well defined. So the precise value of <span class="math inline">\(\omega\)</span> matters more that it does at higher temperatures- even for values of <span class="math inline">\(\phi\)</span> away from <span class="math inline">\(90^\circ\)</span>.</p>
<p>The slowdown distribution does not have a maximum (but actually a minimum) at <span class="math inline">\(v_\parallel = 0\)</span>. Instead it has a sharp maximum and an edge at the velocity corresponding to the birth energy (here 1.4e6 m/s corresponding to 20 keV). For most values of <span class="math inline">\(l\)</span>, the path of the integral will cross that edge fairly perpendicularly. However, in some cases the path will be near tangential to the edge at small values of <span class="math inline">\(v_\perp\)</span>, resulting in a much larger integral. Again, the combined result will then be much more sensitive to the value of <span class="math inline">\(\omega\)</span> when the step in <span class="math inline">\(v_\parallel\)</span> is large (so only a few <span class="math inline">\(l\)</span> values contribute) than when the sum contains contributions from integrals with many many values of <span class="math inline">\(l\)</span>. Similar considerations apply to the ring distritribution, but since it only features a sharp maximum, not an edge, the resulting ion cyclotron structures are far more smooth than for the slowdown distribution.</p>
<p>These arguments can be generalized. When there is a highly localized feature, shuch as a well defined maximum or a sharp edge, in the velocity distribution, and when <span class="math inline">\(\delta v_\parallel = \omega_c/k_\parallel\)</span> is sufficiently large, it matters a great deal whether the value of <span class="math inline">\(\omega\)</span> allows that feature in the distribution to be probed. The result for <span class="math inline">\(\widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> can then depend strongly on the precise value of <span class="math inline">\(\omega\)</span>. From that perspective, the ion cyclotron structures seen for a standard Maxwellian distribution is just a special case of the more general effects of a localized maximum in the distribution.</p>
<p>Additional complexity arises from the factor <span class="math inline">\(p_\perp {\bf c}_l {\bf c}_l^*\)</span> that multiplies the distribution in the integrals. The figure below shows examples of its dependence on <span class="math inline">\(l\)</span> and <span class="math inline">\(p_\perp\)</span> with similar assumptions as above.</p>
<p><img src="j0j0r_intro_files/figure-html/fig15-1.png" width="1536" style="display: block; margin: auto;"></p>
<p>The Bessel functions have roots at irregular intervals, and at those roots the factor <span class="math inline">\(p_\perp {\bf c}_l {\bf c}_l^*\)</span> goes rapidly to zero leading to narrow minima. This will hardly matter, if integrals at many different values of <span class="math inline">\(l\)</span> contribute to the sum. The combined effect will then still lead to a smooth dependence on frequency. But, it is different when <span class="math inline">\(\delta v_\parallel = \omega_c/k_\parallel\)</span> is large, so only a few of the integrals provide significant contributions. It will then matter if one of those roots happens to coincide with a maximum in the velocity distribution. For example, the slowdown distribution with <span class="math inline">\(b=5\)</span> is strongly dominated by the narrow peak near the birth velocity. It is then quite important, whether or not the contribution from that peak is suppressed by a root in <span class="math inline">\(p_\perp {\bf c}_l {\bf c}_l^*\)</span>.</p>
<p>So it is possible for narrow localized features in the velocity distribution to cause both maxima and minima in <span class="math inline">\(\langle\widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span>, and for cyclotron structures to appear even when <span class="math inline">\(\phi\)</span> is quite far from <span class="math inline">\(90^\circ\)</span>.</p>
<p>The figure below shows the zz-component for a sweep of resolved angle and the three distributions discussed above. The dependence on the resolved angle and distribution type is seen to be rather complicated and rich in different types of ion cyclotron features.</p>
<p>Also note that although the Maxwellian and ring-type distribution are very different in velocity space, their <span class="math inline">\(\langle\widetilde{\bf{j}}^{(a0)} \widetilde{\bf{j}}^{(a0)}\rangle\)</span> elements are similar enough that those of a ring distribution could be mistaken for those of a Maxwellian with a large Doppler shift.</p>
<p><img src="j0j0r_intro_files/figure-html/fig16-1.png" width="1536" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#distribution-functions">Distribution functions</a><ul class="nav nav-pills nav-stacked">
<li><a href="#conventions-for-distribution-functions">Conventions for distribution functions</a></li>
      <li><a href="#examples-of-distribution-functions">Examples of distribution functions</a></li>
      </ul>
</li>
      <li>
<a href="#calculating-j0j0">Calculating j0j0</a><ul class="nav nav-pills nav-stacked">
<li><a href="#maxwellian">Maxwellian</a></li>
      <li><a href="#bimaxwellian">Bimaxwellian</a></li>
      <li><a href="#lorentzian">Lorentzian</a></li>
      <li><a href="#ring">Ring</a></li>
      <li><a href="#bivariate-normal">Bivariate Normal</a></li>
      <li><a href="#slowdown">Slowdown</a></li>
      </ul>
</li>
      <li><a href="#effects-of-localized-features-in-the-velocity-distribution">Effects of localized features in the velocity distribution</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Morten Stejner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
